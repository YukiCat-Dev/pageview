{"version":3,"file":"index.mjs","sources":["../src/style.ts","../src/DetailPannel.tsx","../src/pageview.tsx","../src/init.tsx"],"sourcesContent":["import { css } from \"@emotion/css\"\r\n\r\nexport const styleClickable = css({\r\n    cursor: \"pointer\"\r\n})\r\nexport const popper = css({\r\n    opacity: 0,\r\n    background: \"#33333380\",\r\n    color: \"white\",\r\n    padding: \"4px 8px\",\r\n    fontSize: \"13px\",\r\n    borderRadius: \"4px\",\r\n    maxHeight: \"20vh\",\r\n    overflow: \"auto\",\r\n    '&[data-show=\"true\"]': {\r\n        opacity: 1,\r\n        backdropFilter: \"blur(3px)\",\r\n    }, zIndex: 999\r\n})\r\nexport const opacity_trans = css({\r\n    transition: \"opacity 500ms ease-in-out\",\r\n})","import { JSX } from \"solid-js/jsx-runtime\"\r\nimport { PVDate } from \"./data\"\r\nimport { popper, opacity_trans } from \"./style\"\r\nimport { splitProps } from \"solid-js\"\r\n\r\nexport interface DetailPannelProp {\r\n    data: PVDate\r\n    style?: JSX.CSSProperties\r\n    show: boolean\r\n    onTransitionEnd: () => void\r\n    ref?: HTMLDivElement\r\n}\r\nexport function DetailPannel(props: DetailPannelProp) {\r\n    const [{ data }, rest] = splitProps(props, ['data'])\r\n    let content: JSX.Element\r\n    if (data.avgTOP) {\r\n        const avgTop = parseFloat(data.avgTOP)\r\n        content = <>\r\n            <li>\r\n                {`平均浏览时间:${toTime(avgTop)}`}\r\n            </li>\r\n            <li>\r\n                {`总浏览时间:${toTime(avgTop * parseInt(data.hit), 0)}`}\r\n            </li>\r\n        </>\r\n    }\r\n    return <div class={popper + ' ' + opacity_trans}\r\n        {...rest}>\r\n        <li>\r\n            {`浏览量:${data.hit}`}\r\n        </li>\r\n        {content}\r\n    </div>\r\n}\r\n\r\n\r\nconst toTime = (time: string | number, secFix: number = 2) => {\r\n    const _hour = (typeof time == 'string' ? parseFloat(time) : time) / 3600//second\r\n    const hour = _hour | 0\r\n    const _min = (_hour - hour) * 60\r\n    const min = _min | 0\r\n    const second = (_min - min) * 60\r\n    const ms = second - (second | 0)\r\n    return `${hour > 0 ? `${hour}小时` : ''}${min > 0 ? `${min}分` : ''}${second > 0 ? `${ms > 0 ? second.toFixed(secFix) : second}秒` : ''}`\r\n}","import { batch, createResource, createSignal, JSX, onCleanup, } from \"solid-js\"\r\nimport { Portal } from \"solid-js/web\";\r\nimport { PVDate } from \"./data\";\r\nimport { DetailPannel } from \"./DetailPannel\";\r\nimport { styleClickable } from \"./style\";\r\nimport { autoUpdate, computePosition, flip, shift } from '@floating-ui/dom'\r\n\r\nconst API_PREFIX = 'https://yukicat-ga-hit.vercel.app/api/ga/?page='\r\n\r\nexport function PageView({ path: path_raw, raw }: { path: string, raw: string }) {\r\n    const path = path_raw + (path_raw.endsWith('/') ? '' : '/')\r\n    const [data] = createResource(path, (path) => fetch(API_PREFIX + path).then(r => r.json() as Promise<PVDate[]>))\r\n    const error = data.error\r\n    const _rawHit = raw.replace(/<\\/?span>/g, '')\r\n    const [showPannel, setShowPannel] = createSignal(false)\r\n    const [mountPannel, setMountPannel] = createSignal(false)\r\n    const [ticker, setTicker] = createSignal<number>()\r\n    const [popperStyle, setPopperStyles] = createSignal<JSX.CSSProperties>({ position: 'absolute', left: 0, top: 0, width: 'max-content' })\r\n    let refEle: HTMLSpanElement | undefined\r\n    let refPopper: HTMLDivElement | undefined\r\n\r\n    const updatePosition = async () => {\r\n        const position = await computePosition(\r\n            refEle!,\r\n            refPopper!,\r\n            {\r\n                placement: 'top',\r\n                middleware: [shift(), flip()]\r\n            }\r\n        )\r\n        setPopperStyles((prevStyle) => {\r\n            return {\r\n                ...prevStyle,\r\n                left: `${position.x}px`,\r\n                top: `${position.y}px`,\r\n            }\r\n        })\r\n    }\r\n    let cleanupAutoUpdate: (() => void) | undefined\r\n\r\n    onCleanup(() => {\r\n        clearTimeout(ticker())\r\n        cleanupAutoUpdate?.()\r\n    })        //cleaner\r\n    return <>\r\n        <span onClick={() => {\r\n            if (ticker()) {\r\n                clearTimeout(ticker())\r\n                setTicker(undefined)\r\n            }\r\n            const nextShowPannel = setShowPannel(prev => !prev)\r\n\r\n            if (nextShowPannel) {\r\n                batch(() => {\r\n                    setMountPannel(true)\r\n                    setTicker(\r\n                        setTimeout(() => {\r\n                            batch(() => {\r\n                                setShowPannel(false)\r\n                                setTicker(undefined)\r\n                            })\r\n                        }, 5000)\r\n                    )\r\n                })\r\n                updatePosition()\r\n                cleanupAutoUpdate = autoUpdate(refEle!, refPopper!, updatePosition)\r\n            }\r\n        }}\r\n            ref={refEle}\r\n            data-raw={raw}\r\n            class={styleClickable}>\r\n            {error ? _rawHit.replace(/\\d{1,}/, '-') : (data() ? _rawHit.replace(/\\d{1,}/, data()![0].hit) : _rawHit)}\r\n            {mountPannel() && <Portal>\r\n                <DetailPannel ref={refPopper}\r\n                    data={(data()?.[0]) ?? { hit: _rawHit }}\r\n                    style={popperStyle()}\r\n                    show={showPannel()}\r\n                    onTransitionEnd={() => {\r\n                        cleanupAutoUpdate?.()\r\n                        cleanupAutoUpdate = undefined\r\n                        setMountPannel(false)\r\n                    }} />\r\n            </Portal>}\r\n        </span>\r\n    </>\r\n}\r\n\r\n","import { render } from \"solid-js/web\"\r\nimport { PageView } from \"./pageview\"\r\nexport const initPV = () => {\r\n    const observer = new IntersectionObserver((entries) => {\r\n        for (const entry of entries) {\r\n            if (!entry.isIntersecting) continue\r\n            const element = entry.target as HTMLElement\r\n            const raw = element.innerText\r\n            element.innerText = ''\r\n            render(() => <PageView\r\n                path={element.attributes.getNamedItem('data-path')!.value}\r\n                raw={raw} />,\r\n                element)\r\n            observer.unobserve(element)\r\n        }\r\n    })\r\n    for (const element of document.getElementsByClassName('meta-page-view') as HTMLCollectionOf<HTMLElement>) {\r\n        observer.observe(element)\r\n    }\r\n}"],"names":["DetailPannel","props","data","rest","splitProps","content","avgTOP","avgTop","parseFloat","_el$","_tmpl$","_$insert","toTime","_el$2","parseInt","hit","_el$3","_tmpl$2","_el$4","firstChild","_$className","popper","opacity_trans","_$spread","time","secFix","_hour","hour","_min","min","second","ms","toFixed","API_PREFIX","PageView","path","path_raw","raw","endsWith","createResource","fetch","then","r","json","error","_rawHit","replace","showPannel","setShowPannel","createSignal","mountPannel","setMountPannel","ticker","setTicker","popperStyle","setPopperStyles","position","left","top","width","refEle","refPopper","updatePosition","computePosition","placement","middleware","shift","flip","prevStyle","x","y","cleanupAutoUpdate","onCleanup","clearTimeout","_ref$","_$use","$$click","undefined","nextShowPannel","prev","batch","setTimeout","autoUpdate","_$setAttribute","styleClickable","_c$","_$memo","_$createComponent","Portal","children","ref","r$","_ref$2","style","show","onTransitionEnd","_$delegateEvents","initPV","observer","IntersectionObserver","entries","entry","isIntersecting","element","target","innerText","render","attributes","getNamedItem","value","unobserve","document","getElementsByClassName","observe"],"mappings":"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"}